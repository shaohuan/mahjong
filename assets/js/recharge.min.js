jQuery(document).ready(function(){function a(){var a=localStorage.getItem("headimgurl");a&&null!=a.match(/\.(jpeg|jpg|gif|png)$/)&&$("#profile-img").attr("src",headimgurl),$("#user_name").html(localStorage.getItem("user_name")),$("#role_name").html("admin"==localStorage.getItem("role_name")?"超级用户":"代理用户"),$("#doudou").html(localStorage.getItem("doudou"))}function b(a,b){$("#"+b).html(a).css("visibility","visible")}function c(a){$("#"+a).css("visibility","hidden")}function d(a,b){var c={orderid:"充值ID",op_userid:"操作人ID",user_id:"用户ID",nick_name:"昵称",left_beans:"操作人剩余柑子",creation_time:"时间",fee:"充值数",costs:"花费金额",beans:"充值柑子",descrption:"描述",status:"订单状态"},d=[],e=-1,f="",g=b[0];d[++e]="<thead><tr>";for(var h in g)f=c[h]?c[h]:h,d[++e]='<th scope="col">'+f+"</th>";for(d[++e]="</tr></thead>",d[++e]="<tbody>",i=0,size=b.length;i<size;i++)d[++e]="<tr>",$.each(b[i],function(a,b){f=c[a]?c[a]:"",d[++e]='<td data-table-header="'+f+'">',d[++e]=b+"</td>"}),d[++e]="</tr>";d[++e]="</tbody>",$("#"+a).html(d.join(""))}function e(a,b){var c,d={user_id:"用户ID",total_score:"用户分数",doudou:"柑子",sex:"性别",win_rounds:"赢回合数",total_rounds:"总回合数",headimgurl:"头像",user_name:"用户名"},e=[],f=-1,g="",h=b[0];e[++f]="<thead><tr>";for(var i in h)g=d[i]?d[i]:i,e[++f]='<th scope="col">'+g+"</th>";e[++f]="</tr></thead>",e[++f]="<tbody>";for(var j=0,k=b.length;k>j;j++)e[++f]="<tr>",$.each(b[j],function(a,b){return g=d[a]?d[a]:"","headimgurl"==a?(c=null!=b.match(/\.(jpeg|jpg|gif|png)$/)?b:"./assets/img/thumbnail.png",e[++f]='<td data-table-header="'+g+'">',e[++f]='<img alt="头像" class="tb-portrait" src="'+c+'" ></td>',!0):("sex"==a&&(b=1==b?"男":"女"),e[++f]='<td data-table-header="'+g+'">',void(e[++f]=b+"</td>"))}),e[++f]="</tr>";e[++f]="</tbody>",$("#"+a).html(e.join(""))}function f(a,d,e,f,g,h){var i;i="get"==d.toLowerCase()?"application/json; charset=utf-8":"application/x-www-form-urlencoded",$.ajax({url:a,contentType:i,data:$.extend(e,{token:localStorage.token}),error:function(a){return 200!=a.status?(b("请求出错，错误代码："+a.status,h),void g(a)):void 0},success:function(a){if(a.error_code&&10041==a.error_code)alert("Token过期，请重新登陆!"),localStorage.removeItem("token"),window.location.href="index.html";else switch(a.error_code){case 0:c(h),f(a);break;case 1:b("未知的错误",h);break;case 2:b("手机格式非法",h);break;case 3:b("参数为空",h);break;case 4:b("没有授权",h);break;case 10001:b("错误码验证失败",h);break;case 10002:b("昵称已经存在",h);break;case 10003:b("设置密码太短",h);break;case 10004:b("手机号码已经存在",h);break;case 10021:b("密码错误",h);break;case 10041:b("token非法",h);break;case 10042:b("验证码已发送",h);break;case 10043:b("验证码超时",h);break;case 10044:b("验证码发送失败",h);break;case 10045:b("柑子不够",h);break;default:b("请求出错，错误码:"+a.error_code,h)}},type:d})}a(),$(".tabgroup > div").hide(),$(".tabgroup > div:first-of-type").show(),$(".tabs a").click(function(a){a.preventDefault();var b=$(this),c="#"+b.parents(".tabs").data("tabgroup"),d=b.closest("li").siblings().children("a"),e=b.attr("href");d.removeClass("active"),b.addClass("active"),$(c).children("div").hide(),$(e).show()}),"agent"==localStorage.role_name?$("#query_type").append($("<option>",{value:"nick_name",text:"微信昵称"})):$("#query_type").append($("<option>",{value:"user_name",text:"代理账号"})),$("#table_users tbody").delegate("tr","click",function(){var a=$(this).hasClass("highlight");$("#table_users tr").removeClass("highlight"),a||$(this).addClass("highlight")}),$("#confirm_recharge").click(function(){var a=$("#beans").val(),c=$("#table_users tr.highlight");if(0==c.length)return void b("请先选择一个用户","recharge-error");if(isNaN(a)||0==a.trim().length)return void b("柑子必须为数字","recharge-error");var d=c.children("td:first").text();f("/v0/order/create","POST",{user_id:d,beans:parseInt(a)},function(a){$("#beans").val(""),b("充值成功,剩余柑子："+a.beans,"recharge-error")},function(a){},"recharge-error")}),$("#search_user_btn").on("click",function(){var a=(localStorage.getItem("role_name"),{}),d=$("#user_key").val();if(0==d.trim().length)return void b("查询关键字不能为空","recharge-error");var g=$("#query_type").val();a[g]=d,f(" /v0/account/query_list","GET",a,function(a){0==a.user_list.length?b("没有找到匹配用户","recharge-error"):(e("table_users",a.user_list),$("#recharge_amount").css("visibility","visible"),c("recharge-error"))},function(a){},"recharge-error")}),$("#tab2 div.record_query_btn").click(function(){f(" /v0/order/query","GET",{status:1},function(a){0==a.order_list.length?b("查询结果为空","history-error"):(d("order_list",a.order_list),$("#recharge_amount").css("visibility","visible"),c("history-error"))},function(a){},"history-error")})});